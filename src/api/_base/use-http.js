import {useAxios} from './use-axios'
import {useGlobalUser} from "../../context";

export function useHttp(baseURL, headers) {

	const instance = useAxios(baseURL, headers)

	const [, setUser] = useGlobalUser();

	async function get(url) {
		let response;
		try {
			response = await instance.get(url)
		} catch (e) {
			if (e.response && e.response.status === 401) {
				setUser({});
			}
			throw e;
		}
		return response
	}

	async function post(url, data) {
		let response;
		try {
			response = await instance.post(url, data)
		} catch (e) {
			if (e.response && e.response.status === 401) {
				setUser({});
			}
			throw e;
		}
		return response
	}

	async function put(url, data, params) {
		let response;
		try {
			response = await instance.put(url, data, params)
		} catch (e) {
			if (e.response && e.response.status === 401) {
				setUser({});
			}
			throw e;
		}
		return response
	}

	async function erase(url) {
		let response;
		try {
			response = await instance.delete(url)
		} catch (e) {
			if (e.response && e.response.status === 401) {
				setUser({});
			}
			throw e;
		}
		return response
	}

	return {
		get,
		post,
		put,
		erase,
	}
}
