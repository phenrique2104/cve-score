import "./search.style.css"
import { useState, useEffect } from "react";
import { useCveApi } from "../../api/cveApi/useCveApi";
import { Table } from "../table/table";

export const Search = () => {

  const [isLoading, setLoading] = useState();
  const [send, setSend ] = useState(false);
  const [cve, setCve ] = useState();
  const [data, setData ] = useState();
  const cveApi = useCveApi();

  useEffect(() => {
    if(send){
      async function getCve() {
        try {
          setLoading('Carregando');
          const response = await cveApi.GetCve(
            cve
          )
          if(response.data === null){
            setLoading('Not Found');
            console.log(response.data);
          }else{
            setLoading('');
            setData(response.data)
            console.log(response.data);
          }
          
        } catch (error) {
          setLoading('Not Found');
          console.log(error)
        }
      }
      setSend(false);
      getCve();

    }
    
  }, [send])

  const sendNewRequest = () => {
    setSend(true)
  }

  const setNewValue = (changes) => {
    setCve(changes.target.value);
  }

  return (
    <>
      <div className="search">
        <h1>Search for CVE</h1>
        <input type="text" maxLength={5} placeholder="CVE" pattern="[+-]?\d+(?:[.,]\d+)?" onChange={setNewValue}></input>
        <button onClick={sendNewRequest}>Search</button>
        <h2>
          {isLoading}
        </h2>
        <Table
          dataTable={data}
        />
      </div>
  
    </>
  )
}



